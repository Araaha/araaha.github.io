<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>Araaha</title>
    <link rel="self" type="application/atom+xml" href="https://araaha.me/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://araaha.me"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2025-02-07T00:00:00+00:00</updated>
    <id>https://araaha.me/atom.xml</id>
    <entry xml:lang="en">
        <title>Extreme ZSH Performance</title>
        <published>2025-02-07T00:00:00+00:00</published>
        <updated>2025-02-07T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://araaha.me/blog/zsh-perf/"/>
        <id>https://araaha.me/blog/zsh-perf/</id>
        
        <content type="html" xml:base="https://araaha.me/blog/zsh-perf/">&lt;p&gt;This blog post is for those looking to improve their ZSH startup time. With a clean &lt;code&gt;.zshrc&lt;&#x2F;code&gt;, ZSH is quite fast. But once you start adding various things to it, it can slow down dramatically.&lt;&#x2F;p&gt;
&lt;p&gt;TLDR: Organize your &lt;code&gt;.zshrc&lt;&#x2F;code&gt; effectively and use &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;romkatv&#x2F;zsh-defer&quot;&gt;zsh-defer&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;performance-analysis&quot;&gt;Performance Analysis&lt;&#x2F;h1&gt;
&lt;p&gt;While you could use everything from &lt;code&gt;zprof&lt;&#x2F;code&gt; to &lt;code&gt;hyperfine&lt;&#x2F;code&gt; and &lt;code&gt;time&lt;&#x2F;code&gt;, the most comprehensive way is with &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;romkatv&#x2F;zsh-bench&quot;&gt;zsh-bench&lt;&#x2F;a&gt;. Just run&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; clone https:&#x2F;&#x2F;github.com&#x2F;romkatv&#x2F;zsh-bench &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d3869b;&quot;&gt;~&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;&#x2F;zsh-bench &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;amp;&amp;amp; cd&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; zsh-bench
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;in your terminal. Running the &lt;code&gt;zsh-bench&lt;&#x2F;code&gt; script outputs this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; benchmarking &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;login&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; shell of user araaha ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;creates_tty&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_compsys&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_syntax_highlighting&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_autosuggestions&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_git_prompt&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_prompt_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;237.871
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;263.405
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;40.244
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;input_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;11.732
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;exit_time_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;90.718
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;on an AMD laptop (Ryzen 5 5500U).&lt;&#x2F;p&gt;
&lt;p&gt;The lines we want to focus on are the latter four:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_prompt_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;237.871
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;263.405
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;40.244
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;input_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;11.732
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The line &lt;code&gt;first_prompt_lag_ms&lt;&#x2F;code&gt; measures the time until the prompt appears. Similarly, &lt;code&gt;first_command_lag_ms&lt;&#x2F;code&gt; measures the time until you can start typing a command. &lt;code&gt;command_lag_ms&lt;&#x2F;code&gt; measures the time between the execution of a command and the first moment a prompt appears thereafter. Lastly, &lt;code&gt;input_lag_ms&lt;&#x2F;code&gt; measures the time between keystrokes. As reference, using a totally clean &lt;code&gt;.zshrc&lt;&#x2F;code&gt;, the following is printed out:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; benchmarking &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;login&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; shell of user araaha ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;creates_tty&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_compsys&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_syntax_highlighting&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_autosuggestions&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_git_prompt&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_prompt_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;12.648
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;13.152
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0.537
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;input_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0.357
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;exit_time_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;10.877
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;organizing-zsh&quot;&gt;Organizing ZSH&lt;&#x2F;h1&gt;
&lt;p&gt;Originally, I had a &lt;code&gt;.zshrc&lt;&#x2F;code&gt; with hundreds of lines. I managed to reduce it to just 7.
You can use &lt;code&gt;$ZDOTDIR&lt;&#x2F;code&gt; to place your zsh config in a dedicated folder. In any case, I have mine exported as&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;ZDOTDIR&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;home&#x2F;araaha&#x2F;.config&#x2F;zsh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;in &lt;code&gt;&#x2F;etc&#x2F;zsh&#x2F;zshenv&lt;&#x2F;code&gt;. That way, &lt;code&gt;$HOME&lt;&#x2F;code&gt; is kept uncluttered. The layout is as follows:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;├─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; modules
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ tty.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ bindkeys.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ fzf.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ aliases.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ prompt.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ zoxide.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ exports.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ compinit.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ zstyle.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ options.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  ├─ pre-defer.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;│&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;  └─ history.zsh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;└─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; plugins
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;├─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; zsh-defer
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;├─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; vi-motions
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;├─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; fast-syntax-highlighting
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;├─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; zsh-autosuggestions
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;└─&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; zsh-completion-generator
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Every plugin I have is placed in &lt;code&gt;plugins&lt;&#x2F;code&gt; and everything else in &lt;code&gt;modules&lt;&#x2F;code&gt;. For example, &lt;code&gt;exports.zsh&lt;&#x2F;code&gt; includes exports I have. Similarly, &lt;code&gt;aliases.zsh&lt;&#x2F;code&gt; includes aliases I have.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;zsh-defer&quot;&gt;Zsh-defer&lt;&#x2F;h1&gt;
&lt;p&gt;Now, rewriting your &lt;code&gt;.zshrc&lt;&#x2F;code&gt; is straightforward. Personally, the first three lines in my &lt;code&gt;.zshrc&lt;&#x2F;code&gt; are:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;ZSH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;HOME&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;.config&#x2F;zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;PLUG&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;ZSH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;plugins&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;export &lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;ZSH&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;modules&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We can start sourcing our modules and plugins and use &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;romkatv&#x2F;zsh-defer&quot;&gt;zsh-defer&lt;&#x2F;a&gt; as much as possible. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;romkatv&#x2F;zsh-defer&quot;&gt;zsh-defer&lt;&#x2F;a&gt; allows us to defer ZSH commands. It has to come before sourcing anything you want to defer. In some cases, you&#x27;ll end up breaking things by deferring. In my case, I can&#x27;t defer the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jeffreytse&#x2F;zsh-vi-mode&quot;&gt;zsh-vi-mode&lt;&#x2F;a&gt; plugin. I also don&#x27;t defer my prompt, zsh opts and my history opts. In any case, the latter three don&#x27;t siginificantly affect startup time.&lt;&#x2F;p&gt;
&lt;p&gt;By the end, I ended up with&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;source &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;ZDOTDIR&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;modules&#x2F;pre-defer.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;defer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;prompt.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;exports.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;aliases.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;bindkeys.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;compinit.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;zstyle.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;zoxide.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;MOD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;fzf.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;PLUG&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;vi-motions&#x2F;motions.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;PLUG&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;zsh-autosuggestions&#x2F;zsh-autosuggestions.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot; &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;PLUG&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;&#x2F;fast-syntax-highlighting&#x2F;fast-syntax-highlighting.zsh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; file &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;defer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d3869b;&quot;&gt;@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;]}&amp;quot;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;do
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;zsh-defer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; source &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;file&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;done
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;which led to this result from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;romkatv&#x2F;zsh-bench&quot;&gt;zsh-bench&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; benchmarking &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;login&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; shell of user araaha ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;creates_tty&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_compsys&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_syntax_highlighting&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_autosuggestions&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;has_git_prompt&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_prompt_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;84.171
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;first_command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;92.650
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;command_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;39.395
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;input_lag_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;11.381
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;exit_time_ms&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;13.126
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The plugins that affect performance the most are &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;zsh-users&#x2F;zsh-autosuggestions&quot;&gt;zsh-autosuggestions&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jeffreytse&#x2F;zsh-vi-mode&quot;&gt;zsh-vi-mode&lt;&#x2F;a&gt;. Without them, &lt;code&gt;command_lag_ms&lt;&#x2F;code&gt; is almost zero and &lt;code&gt;first_prompt_lag_ms&lt;&#x2F;code&gt;, &lt;code&gt;first_command_lag_ms&lt;&#x2F;code&gt; are respectively ~10-20ms.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;additional-optimizations&quot;&gt;Additional Optimizations&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;compinit&quot;&gt;Compinit&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;code&gt;compinit&lt;&#x2F;code&gt; siginificantly affects startup time. We can cache it once a day to speed things up:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#242424;color:#ebdbb280;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;autoload&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt; -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;Uz compinit
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;[ &lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;date&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt; +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;%j&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;#39;) != &lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;date&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt; -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;r &lt;&#x2F;span&gt;&lt;span style=&quot;color:#458588;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;ZSH&#x2F;.zcompdump +&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;%j&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt;&amp;#39;) ]; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;then
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;compinit
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;else
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9dc365;&quot;&gt;compinit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fe8019;&quot;&gt; -&lt;&#x2F;span&gt;&lt;span style=&quot;color:#83a598;&quot;&gt;C
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fb4934;&quot;&gt;fi
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;zcompile&quot;&gt;Zcompile&lt;&#x2F;h2&gt;
&lt;p&gt;Using &lt;code&gt;zcompile&lt;&#x2F;code&gt; on your plugins can have an impact. E.g., using &lt;code&gt;zcompile&lt;&#x2F;code&gt; on &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jeffreytse&#x2F;zsh-vi-mode&quot;&gt;zsh-vi-mode&lt;&#x2F;a&gt; reduces my startup time by ~10ms.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;git-prompt&quot;&gt;Git Prompt&lt;&#x2F;h2&gt;
&lt;p&gt;Using an async git prompt will likely improve performance.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;oh-my-zsh&quot;&gt;Oh-My-ZSH&lt;&#x2F;h2&gt;
&lt;p&gt;OMZ has dozens of plugins, most of which you likely won&#x27;t use. It&#x27;s better to create your own config and only include plugins you regularly use.&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
